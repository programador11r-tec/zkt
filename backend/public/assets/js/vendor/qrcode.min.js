/*!
 * qrcode-generator (MIT)
 * Minimal build exposing QRCode.toCanvas / toDataURL helpers.
 * Source: https://github.com/kazuhikoarase/qrcode-generator
 */
!function(o){function p(o){for(var t=1;256>t;t++)s[t]=s[t-1]<<1,128&s[t-1]&&(s[t]^=285);for(var e=0;e<255;e++)n[s[e]]=e;var r=0,i=0;0!==o&&(r=10>o?0:10>o+2?1:2,i=10>o?7:10>o+2?9:10),h=function(o){var t=[];t.push(f(0,c(o,o,r,i)));for(var e=1;o>e;e++)t.push(f(e,c(o,o,r,i)));return t},l=o}function c(o,t,e,r){for(var i=[],n=0;n<o-1;n++)i[n]=0;return i[o-1]=1,f(o,t).mod(f(o,e)).multiply(f(o,r))}function f(o,t){if(void 0===t&&(t=[]),t.length>0&&(0===t.length||0!==t[0]))throw new Error("lead 0");for(var e=0;e<t.length&&0===t[e];)e++;for(var r=new Array(t.length-e+o),i=0;i<t.length-e;i++)r[i]=t[i+e];return r.length||o||r.push(0),{getLength:function(){return r.length},get:function(o){return r[o]},multiply:function(o){for(var t=new Array(r.length+o.getLength()-1),e=0;e<r.length;e++)for(var i=0;i<o.getLength();i++)t[e+i]^=a(r[e],o.get(i));return f(0,t)},mod:function(o){if(o.getLength()-1>this.getLength()-1)return this;for(var t=a(r[0],o.get(0)),e=new Array(this.getLength()),i=0;i<this.getLength();i++)e[i]=r[i];for(i=0;i<o.getLength();i++)e[i]^=a(o.get(i),t);return f(0,e).mod(o)}}}function a(o,t){return 0===o||0===t?0:s[(n[o]+n[t])%255]}function u(o){for(var t=0;0!==o;)t++,o>>>=1;return t}function d(o,t){for(var e=-1,r=o.length,i=o[0].length,n=new Array(r),s=0;s<r;s++){n[s]=new Array(i);for(var a=0;a<i;a++)n[s][a]=o[s][a];}for(var l=8*(o.length+o[0].length)+16,c=0;8>c;c++){for(var f=0,h=0;h<r;h++)for(var d=0;d<i;d++){var v=n[h][d];v===p&&(f+=3);var m=0;if(h>0&&h<r-1&&v===n[h-1][d]&&v===n[h+1][d]&&(m++,m>=2&&(f+=3)),d>0&&d<i-1&&v===n[h][d-1]&&v===n[h][d+1]&&(m++,m>=2&&(f+=3)),h>0&&d>0&&h<r-1&&d<i-1){var g=0;o[h-1][d-1]===v&&g++,o[h-1][d]===v&&g++,o[h-1][d+1]===v&&g++,o[h][d-1]===v&&g++,o[h][d+1]===v&&g++,o[h+1][d-1]===v&&g++,o[h+1][d]===v&&g++,o[h+1][d+1]===v&&g++,0===g||8===g?f+=3:2===g||6===g?f+=2:4===g&&(f+=1)}if(d>=6&&(v===n[h][d-1]&&v===n[h][d-2]&&v===n[h][d-3]&&v===n[h][d-4]&&v===n[h][d-5]&&v===n[h][d-6]&&(f+=3),v&&0===d%2&&(f+=1)),h>=6&&(v===n[h-1][d]&&v===n[h-2][d]&&v===n[h-3][d]&&v===n[h-4][d]&&v===n[h-5][d]&&v===n[h-6][d]&&(f+=3),v&&0===h%2&&(f+=1))){}}for(var y=0,k=0;k<r;k++)for(var N=0;N<i;N++)n[k][N]||y++;f+=Math.abs(100*y/l-50)/5*10,t>c&&(t=f,e=c)}return e}function v(o,t){this.buffer=[],this.length=0,void 0!==o&&this.put(o,8),void 0!==t&&this.put(t,8)}function m(o){this.mode=1,this.data=o}function g(o){for(var t=o.getModuleCount(),e=[],r=0;r<t;r++){e[r]=[];for(var i=0;i<t;i++)e[r][i]=o.isDark(r,i)?1:0}return e}function b(o){return x[o]}function C(o,t){var e=o.getModuleCount();t.width=t.width||256,t.height=t.height||256;var r=Math.floor(Math.min(t.width,t.height)/e),i=Math.floor((t.width-r*e)/2),n=Math.floor((t.height-r*e)/2);return{size:r,offsetX:i,offsetY:n}}function y(o,t,e){return new Promise(function(r,i){try{o.toBlob?o.toBlob(function(o){if(!o)return i(new Error("No blob generated"));var t=new FileReader;t.onloadend=function(){r(t.result)},t.readAsDataURL(o)},e||"image/png"):(i(new Error("toBlob not supported")))}catch(o){i(o)}})}var l=1,h=null,x={L:1,M:0,Q:3,H:2},s=new Array(256),n=new Array(256);p(1);var r=[[],[1,26,19],[1,44,34],[1,70,55],[1,100,80],[1,134,108],[2,86,68],[2,98,78],[2,121,97],[2,146,116],[2,86,68,2,87,69],[4,101,81],[2,116,92,2,117,93],[4,133,107],[3,145,115,1,146,116],[5,109,87,1,110,88],[5,122,98,1,123,99],[1,135,107,5,136,108],[5,150,120,1,151,121],[3,141,113,4,142,114],[3,135,107,5,136,108],[4,144,116,4,145,117],[2,139,111,7,140,112],[4,151,121,4,152,122],[6,147,117,2,148,118],[8,132,106,1,133,107],[10,142,114,1,143,115],[8,152,122,4,153,123],[3,147,117,10,148,118],[7,146,116,7,147,117],[5,145,115,10,146,116],[13,145,115,3,146,116],[17,145,115],[17,145,115,1,146,116],[13,145,115,6,146,116],[12,151,121,7,152,122],[6,151,121,14,152,122],[17,152,122],[4,152,122,18,153,123],[20,147,117,4,148,118],[19,148,118,6,149,119],[18,150,120,8,151,121],[20,141,113,8,142,114],[19,142,114,10,143,115],[16,147,117,14,148,118],[18,148,118,16,149,119],[21,146,116,13,147,117],[20,146,116,17,147,117],[19,150,120,17,151,121],[18,150,120,19,151,121],[17,152,122,21,153,123],[17,152,122,22,153,123],[14,152,122,26,153,123],[13,152,122,28,153,123],[23,147,117,21,148,118],[23,147,117,22,148,118],[19,147,117,26,148,118],[23,151,121,25,152,122],[23,151,121,28,152,122],[19,147,117,34,148,118],[11,153,123,36,154,124],[59,146,116,1,147,117],[60,146,116],[55,146,116,9,147,117],[58,146,116,2,147,117],[44,150,120,15,151,121],[39,150,120,25,151,121],[46,150,120,17,151,121],[49,150,120,18,151,121],[48,150,120,20,151,121],[43,150,120,29,151,121],[34,150,120,40,151,121],[46,150,120,30,151,121],[49,150,120,28,151,121],[48,150,120,31,151,121],[43,150,120,40,151,121],[34,150,120,48,151,121],[35,150,120,52,151,121],[48,150,120,40,151,121],[43,150,120,48,151,121],[36,150,120,57,151,121],[12,151,121,92,152,122],[11,151,121,98,152,122],[11,151,121,100,152,122],[7,151,121,122,152,122],[7,151,121,123,152,122],[7,151,121,124,152,122],[7,151,121,125,152,122]],i={L:1,M:0,Q:3,H:2},t=function(o,t){this.typeNumber=o,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]};t.prototype={addData:function(o){this.dataList.push(new m(o)),this.dataCache=null},isDark:function(o,t){if(0>o||this.moduleCount<=o||0>t||this.moduleCount<=t)throw new Error(o+","+t);return this.modules[o][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.typeNumber<1&&function(o){for(var t=1;t<40;t++){var e=r[t];if(e)for(var n=0;n<e.length;n+=3){var i=new t(t,1);i.addData("");try{i.makeImpl(!1,0),o(t);break}catch(o){}}}}(function(o){this.typeNumber=o}.bind(this)),this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(o,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++){this.modules[e]=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++)this.modules[e][n]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.typeNumber>=7&&this.setupTypeNumber(o),this.setupTypeInfo(o,t),this.dataCache=this.createData(),this.mapData(this.dataCache,t)},setupPositionProbePattern:function(o,t){for(var e=-1;7>=e;e++)if(!(o+e<=-1||this.moduleCount<=o+e))for(var n=-1;7>=n;n++)t+n<=-1||this.moduleCount<=t+n||(this.modules[o+e][t+n]=e>=0&&6>=e&&(0==n||6==n)||n>=0&&6>=n&&(0==e||6==e)||e>=2&&4>=e&&n>=2&&4>=n)},getBestMaskPattern:function(){for(var o=0,t=0,e=0;8>e;e++){this.makeImpl(!0,e);var n=d(this.modules,o||1/0);(0==e||t>n)&&(t=n,o=e)}return o},createData:function(){for(var o=b("L"),t=r[this.typeNumber],e=[],n=0;n<this.dataList.length;n++)e.push(this.dataList[n]);for(var i=0,c=0;c<t.length;c+=3)i+=t[c+1];var a=new v;for(c=0;c<e.length;c++){var u=e[c];a.put(4,4),a.put(u.getLength(),u.getLengthInBits(this.typeNumber)),u.write(a)}for(a.getLengthInBits()>8*i&&console.error("code length overflow. ("+a.getLengthInBits()+">"+8*i+ ")");a.getLengthInBits()+4<=8*i;)a.put(0,4);for(;a.getLengthInBits()%8!=0;)a.putBit(!1);for(;a.getLengthInBits()<8*i;)a.put(236,8),a.getLengthInBits()<8*i&&a.put(17,8);return QRCodeModel.createBytes(a.getBuffer(),t,o)},mapData:function(o,t){for(var e=-1,n=this.moduleCount-1,r=7,i=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var c=0;2>c;c++)if(null==this.modules[n][a-c]){var u=!1;i<o.length&&(u=1==(o[i]>>>r&1)),function(o,t,e){switch(o){case 0:return(t+e)%2==0;case 1:return t%2==0;case 2:return e%3==0;case 3:return(t+e)%3==0;case 4:return(Math.floor(t/2)+Math.floor(e/3))%2==0;case 5:return t*e%2+t*e%3==0;case 6:return(t*e%2+t*e%3)%2==0;case 7:return(t*e%3+(t+e)%2)%2==0;default:throw new Error("bad maskPattern:"+o)}}(t,n,a-c)&&(u=!u),this.modules[n][a-c]=u,r--,-1==r&&(i++,r=7)}if(n+=e,n<0||this.moduleCount<=n){n-=e,e=-e;break}}},setupTimingPattern:function(){for(var o=8;o<this.moduleCount-8;o++)null==this.modules[o][6]&&(this.modules[o][6]=o%2==0),null==this.modules[6][o]&&(this.modules[6][o]=o%2==0)},setupPositionAdjustPattern:function(){for(var o=function(o){var t="";switch(o){case 1:t="";break;case 2:t="6,18";break;case 3:t="6,22";break;default:t="6";for(var e=30,n=1;n<o-1;n++)t+=","+e,e+=4}"6,"+t+",6"},t=o(this.typeNumber).split(","),e=0;e<t.length;e++)for(var n=0;n<t.length;n++){var r=parseInt(t[e],10),i=parseInt(t[n],10);if(null==this.modules[r][i])for(var a=-2;2>=a;a++)for(var c=-2;2>=c;c++)this.modules[r+a][i+c]=-2==a||2==a||-2==c||2==c||0==a&&0==c}},setupTypeNumber:function(o){for(var t=QRUtil.getBCHTypeNumber(this.typeNumber),e=0;18>e;e++){var n=!o&&(1==(t>>e&1));this.modules[Math.floor(e/3)][e%3+this.moduleCount-8-3]=n,this.modules[e%3+this.moduleCount-8-3][Math.floor(e/3)]=n}},setupTypeInfo:function(o,t){for(var e=this.errorCorrectLevel<<3|t,n=QRUtil.getBCHTypeInfo(e),r=0;15>r;r++){var i=!o&&(1==(n>>r&1));r<6?this.modules[r][8]=i:r<8?this.modules[r+1][8]=i:this.modules[this.moduleCount-15+r][8]=i}for(r=0;15>r;r++){i=!o&&(1==(n>>r&1));r<8?this.modules[8][this.moduleCount-1-r]=i:r<9?this.modules[8][15-r-1+1]=i:this.modules[8][15-r-1]=i}this.modules[this.moduleCount-8][8]=!o}},QRUtil={getBCHTypeInfo:function(o){for(var t=o<<10;QRUtil.getBCHDigit(t)-QRUtil.getBCHDigit(1335)>=0;)t^=1335<<QRUtil.getBCHDigit(t)-QRUtil.getBCHDigit(1335);return(o<<10|t)^21522},getBCHTypeNumber:function(o){for(var t=o<<12;QRUtil.getBCHDigit(t)-QRUtil.getBCHDigit(7973)>=0;)t^=7973<<QRUtil.getBCHDigit(t)-QRUtil.getBCHDigit(7973);return o<<12|t},getBCHDigit:function(o){for(var t=0;0!==o;)t++,o>>>=1;return t}},QRCodeModel=t,v.prototype={get:function(o){return 1==(this.buffer[Math.floor(o/8)]>>>7-o%8&1)},put:function(o,t){for(var e=0;t>e;e++)this.putBit(1==(o>>>t-e-1&1))},getLengthInBits:function(){return this.length},putBit:function(o){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),o&&(this.buffer[t]|=128>>>this.length%8),this.length++},getBuffer:function(){return this.buffer}},m.prototype={getLength:function(){return this.data.length},write:function(o){for(var t=0;t<this.data.length;t++)o.put(this.data.charCodeAt(t),8)},getLengthInBits:function(o){return 1<=o&&10>o?8:27>o?16:16}},o.QRCode={toCanvas:function(o,t,e,r){return"function"==typeof e&&(r=e,e=void 0),"string"==typeof o&&(o=document.querySelector(o)),e=e||{},e.text=t,this._generate(e).then(function(t){var n=C(t,e),i=o.getContext("2d");o.width=e.width||256,o.height=e.height||256,i.clearRect(0,0,o.width,o.height),i.fillStyle=e.colorLight||"#fff",i.fillRect(0,0,o.width,o.height),i.fillStyle=e.colorDark||"#000";for(var s=0;s<t.length;s++)for(var a=0;a<t.length;a++)t[s][a]&&(i.fillRect(n.offsetX+a*n.size,n.offsetY+s*n.size,n.size,n.size));r&&r()},"function"==typeof r?r:null)},toDataURL:function(o,t){return t=t||{},this._generate(t).then(function(e){var r=document.createElement("canvas"),i=C(e,t),n=r.getContext("2d");r.width=t.width||256,r.height=t.height||256,n.fillStyle=t.colorLight||"#fff",n.fillRect(0,0,r.width,r.height),n.fillStyle=t.colorDark||"#000";for(var s=0;s<e.length;s++)for(var a=0;a<e.length;a++)e[s][a]&&(n.fillRect(i.offsetX+a*i.size,i.offsetY+s*i.size,i.size,i.size));return y(r,"image/png")})},_generate:function(o){return ensureQrLib().then(function(){var t=new QRCodeModel(o.typeNumber||1,i[o.errorCorrectionLevel||"M"]||0);t.addData(o.text||"");t.make();return Promise.resolve(g(t))})}}}(this);
