<!DOCTYPE html>
<html lang="es" data-bs-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZKTeco ↔ G4S FEL • Panel</title>

  <!-- Bootstrap core CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- Tu hoja (si la tienes) -->
  <link rel="stylesheet" href="/assets/css/styles.css">

  <!-- Estilos mínimos encima del template -->
  <style>
    :root{
      --celeste-1:#6ec1e4;
      --celeste-2:#2fa4ff;
      --sidebar-width: 260px;
    }
    body{ background:#f6f7fb; font-family: Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; }

    /* Topbar */
    .navbar-top{
      background: linear-gradient(90deg, var(--celeste-1) 0%, var(--celeste-2) 100%);
    }
    .navbar-top .navbar-brand, .navbar-top .nav-link, .navbar-top .btn, .navbar-top .badge{
      color:#fff !important; text-shadow:0 1px 2px rgba(0,0,0,.25);
    }
    .navbar-top .btn-outline-light{ border-color:rgba(255,255,255,.75); }
    .navbar-top .btn-outline-light:hover{ background:rgba(255,255,255,.16); }

    /* Sidebar “card” look */
    .sidebar-wrapper{
      width: var(--sidebar-width);
    }
    .sidebar-card{
      background:#fff;
      border:1px solid var(--bs-border-color);
      border-radius:1rem;
      box-shadow:0 .25rem .75rem rgba(0,0,0,.04);
      height: calc(100vh - 56px); /* 56px ~ altura navbar */
      overflow-y:auto;
    }
    .sidebar .section-title{
      font-size:.75rem; text-transform:uppercase; letter-spacing:.05em; color:#6c757d; margin-bottom:.5rem;
    }
    .sidebar .nav-link{
      display:flex; align-items:center; gap:.6rem;
      padding:.5rem .75rem; border-radius:.75rem; color:#333;
    }
    .sidebar .nav-link:hover{ background:rgba(13,110,253,.08); color:#0d6efd; }
    .sidebar .nav-link.active{ background:#0d6efd; color:#fff !important; }
    .sidebar .nav-link .bi{ width:1.25rem; text-align:center; }

    .status-wrap{
      background:#f8f9fa; border:1px dashed var(--bs-border-color);
      border-radius:.75rem; padding:.75rem;
    }

    /* Layout: el contenido ocupa el resto */
    .main-area{ min-height: calc(100vh - 56px); }

    /* Mejor legibilidad en títulos */
    h1,h2,h3,h4,h5{ color:#0c3a5a; }

    /* Correcciones para collapse horizontal */
    .collapse-horizontal:not(.show) .sidebar-wrapper{ width:0; }
    .collapse-horizontal .sidebar-wrapper{ transition: width .3s ease; }
  </style>
</head>
<body>

  <!-- Topbar -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-top sticky-top">
    <div class="container-fluid px-3">
      <!-- Toggle móvil: Offcanvas -->
      <button class="btn btn-outline-light d-lg-none me-2" type="button"
              data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas" aria-controls="sidebarOffcanvas">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Toggle escritorio: Collapse horizontal -->
      <button class="btn btn-outline-light d-none d-lg-inline-flex me-2"
              id="btnSidebarToggle" data-bs-toggle="collapse" data-bs-target="#sidebarCollapse"
              aria-controls="sidebarCollapse" aria-expanded="true" aria-label="Mostrar/ocultar menú">
        <i class="bi bi-layout-sidebar-inset"></i>
      </button>

      <a class="navbar-brand d-flex align-items-center gap-2" href="#">
        <span class="badge bg-white text-dark">FEL</span>
        <span class="fw-semibold text-white">ZKTeco ↔ G4S</span>
      </a>

      <div class="ms-auto d-flex align-items-center gap-2">
        <span class="badge bg-white text-dark" id="envBadge" data-status="local">Local</span>
        <button id="refreshBtn" class="btn btn-sm btn-outline-light">Actualizar</button>
      </div>
    </div>
  </nav>

  <!-- Layout principal (template Bootstrap dashboard) -->
  <div class="container-fluid">
    <div class="row flex-nowrap">
      <!-- Sidebar: Collapse horizontal en ≥lg -->
      <div class="col-auto px-0 d-none d-lg-block collapse collapse-horizontal show" id="sidebarCollapse">
        <div class="sidebar-wrapper">
          <aside class="sidebar-card p-3 sidebar">
            <div class="section-title">Menú</div>
            <ul class="nav nav-pills flex-column gap-1">
              <li class="nav-item">
                <a class="nav-link active" href="#" data-page="dashboard">
                  <i class="bi bi-speedometer2"></i> Dashboard
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" data-page="invoices">
                  <i class="bi bi-receipt"></i> Facturación
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" data-page="settings">
                  <i class="bi bi-gear"></i> Ajustes
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" data-page="reports">
                  <i class="bi bi-graph-up"></i> Reportes
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" data-page="ManualInvoice">
                  <i class="bi bi-file-earmark-plus"></i> Factura manual
                </a>
              </li>
            </ul>
          </aside>
        </div>
      </div>

      <!-- Offcanvas móvil (template Bootstrap puro) -->
      <div class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="sidebarOffcanvas" aria-labelledby="sidebarOffcanvasLabel">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="sidebarOffcanvasLabel">Menú</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
        </div>
        <div class="offcanvas-body">
          <ul class="nav nav-pills flex-column gap-1">
            <li class="nav-item"><a class="nav-link active" href="#" data-page="dashboard" data-bs-dismiss="offcanvas"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="#" data-page="invoices" data-bs-dismiss="offcanvas"><i class="bi bi-receipt"></i> Facturación</a></li>
            <li class="nav-item"><a class="nav-link" href="#" data-page="settings" data-bs-dismiss="offcanvas"><i class="bi bi-gear"></i> Ajustes</a></li>
            <li class="nav-item"><a class="nav-link" href="#" data-page="reports" data-bs-dismiss="offcanvas"><i class="bi bi-graph-up"></i> Reportes</a></li>
            <li class="nav-item"><a class="nav-link" href="#" data-page="ManualInvoice" data-bs-dismiss="offcanvas"><i class="bi bi-file-earmark-plus"></i> Factura manual</a></li>
          </ul>
        </div>
      </div>

      <!-- Contenido -->
      <main class="col py-3 main-area" id="mainContent">
        <div id="app" class="container-fluid"></div>
        <footer class="mt-4 pt-3 border-top">
          <div class="text-muted small">© <span id="y"></span> R-tec</div>
        </footer>
      </main>
    </div>
  </div>

  <!-- Modal base -->
  <div class="modal fade" id="appModal" tabindex="-1" aria-labelledby="appModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="appModalLabel">Modal</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body" id="appModalBody">Contenido…</div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-primary" id="appModalOk">Aceptar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Helpers mínimos -->
  <script>
    // Año footer
    document.getElementById('y').textContent = new Date().getFullYear();

    // Salud API
    fetch('api/health').then(r=>r.json()).then(_=>{
      for (const id of ['health-pill','health-pill-mobile']){
        const el = document.getElementById(id);
        if (el){ el.textContent='API OK'; el.className='badge bg-success-subtle text-success-emphasis'; }
      }
    }).catch(()=>{
      for (const id of ['health-pill','health-pill-mobile']){
        const el = document.getElementById(id);
        if (el){ el.textContent='API caída'; el.className='badge bg-danger-subtle text-danger-emphasis'; }
      }
    });


    
    // Dialog fallback (por si tu app.js lo usa)
    window.Dialog = window.Dialog || {
      loading: ({title, message})=>{
        const id='dlg-load-'+Math.random().toString(36).slice(2);
        const el=document.createElement('div');
        el.id=id;
        el.className='position-fixed bottom-0 end-0 m-3 p-3 bg-white border rounded shadow';
        el.innerHTML='<div class="d-flex align-items-center gap-2"><div class="spinner-border spinner-border-sm" role="status"></div><div><strong>'
          +(title||'Cargando')+'</strong><div class="small text-muted">'+(message||'')+'</div></div></div>';
        document.body.appendChild(el);
        return { close(){ el.remove(); } };
      },
      alert: ({title, message, html}) => alert((title?title+': ':'') + (message || (html? html.replace(/<br\s*\/?>/gi,'\n').replace(/<[^>]+>/g,'') : '')))
    };
  </script>

  <!-- Tu app -->
  <script src="/assets/js/app.js" defer></script>
</body>
</html>
